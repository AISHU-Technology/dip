<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DIP Hub API 文档</title>
  <link rel="stylesheet" type="text/css" href="https://unpkg.com/swagger-ui-dist@5/swagger-ui.css">
  <style>
    html { box-sizing: border-box; overflow-y: scroll; }
    *, *:before, *:after { box-sizing: inherit; }
    body { margin: 0; background: #fafafa; }
    .swagger-ui .topbar { display: none; }
  </style>
</head>
<body>
  <div id="swagger-ui"></div>
  <script src="https://unpkg.com/swagger-ui-dist@5/swagger-ui-bundle.js"></script>
  <script src="https://unpkg.com/swagger-ui-dist@5/swagger-ui-standalone-preset.js"></script>
  <script>
    // 内联的 OpenAPI 规范（解决直接打开 HTML 文件时的 CORS 问题）
    const spec = {
      "openapi": "3.1.0",
      "info": {
        "title": "DIP HUB 应用商店接口",
        "description": "DIP HUB 应用商店管理接口文档。\n\n## 功能模块\n\n### 应用管理 (Application)\n- **安装应用**: POST /applications - 上传 zip 格式安装包进行安装\n- **获取应用列表**: GET /applications - 获取已安装的应用列表\n- **配置应用**: PUT /applications/config - 配置业务知识网络和智能体\n- **查看基础信息**: GET /applications/basic-info - 查看应用基本信息\n- **查看业务知识网络**: GET /applications/ontologies - 查看业务知识网络配置\n- **查看智能体**: GET /applications/agents - 查看智能体配置\n- **卸载应用**: DELETE /applications/{key} - 卸载指定应用",
        "version": "1.0.0",
        "contact": {
          "name": "DIP Hub Team"
        }
      },
      "tags": [
        {
          "name": "Application",
          "description": "应用管理接口"
        }
      ],
      "security": [
        {
          "BearerAuth": []
        }
      ],
      "servers": [
        {
          "url": "/api/dip-hub/v1",
          "description": "DIP Hub API 服务"
        }
      ],
      "paths": {
        "/applications": {
          "post": {
            "operationId": "installApplication",
            "summary": "安装应用",
            "description": "安装应用包，使用流式上传。\n\n**流程说明：**\n1. 上传 zip 格式安装包（流式上传）\n2. Server 端边接收边写盘\n3. 校验应用安装包结构和 manifest.yaml\n4. 解析 application.key，校验 version\n5. 如果应用已存在，版本号必须大于已上传版本\n6. 解压安装包，上传镜像和 Chart\n7. 导入业务知识网络和 DataAgent 智能体\n8. 更新应用信息",
            "tags": ["Application"],
            "requestBody": {
              "required": true,
              "content": {
                "application/octet-stream": {
                  "schema": {
                    "type": "string",
                    "format": "binary",
                    "description": "zip 格式应用安装包（流式上传）"
                  }
                }
              }
            },
            "responses": {
              "200": {
                "description": "安装成功",
                "content": {
                  "application/json": {
                    "schema": {
                      "$ref": "#/components/schemas/Application"
                    }
                  }
                }
              },
              "400": {
                "description": "请求参数错误",
                "content": {
                  "application/json": {
                    "schema": {
                      "$ref": "#/components/schemas/ErrorResponse"
                    }
                  }
                }
              },
              "409": {
                "description": "资源冲突（如版本号冲突）",
                "content": {
                  "application/json": {
                    "schema": {
                      "$ref": "#/components/schemas/ErrorResponse"
                    }
                  }
                }
              },
              "500": {
                "description": "服务器内部错误",
                "content": {
                  "application/json": {
                    "schema": {
                      "$ref": "#/components/schemas/ErrorResponse"
                    }
                  }
                }
              }
            }
          },
          "get": {
            "operationId": "listApplications",
            "summary": "获取应用列表",
            "description": "获取当前已安装的所有应用列表。",
            "tags": ["Application"],
            "responses": {
              "200": {
                "description": "获取已安装的应用列表",
                "content": {
                  "application/json": {
                    "schema": {
                      "$ref": "#/components/schemas/ApplicationList"
                    }
                  }
                }
              },
              "500": {
                "description": "服务器内部错误",
                "content": {
                  "application/json": {
                    "schema": {
                      "$ref": "#/components/schemas/ErrorResponse"
                    }
                  }
                }
              }
            }
          }
        },
        "/applications/config": {
          "put": {
            "operationId": "configureApplication",
            "summary": "配置应用",
            "description": "配置应用的业务知识网络和智能体。",
            "tags": ["Application"],
            "parameters": [
              {
                "name": "app_id",
                "in": "query",
                "description": "应用 ID（key）",
                "required": true,
                "schema": {
                  "type": "string",
                  "maxLength": 32
                }
              }
            ],
            "requestBody": {
              "required": true,
              "content": {
                "application/json": {
                  "schema": {
                    "$ref": "#/components/schemas/ApplicationConfigRequest"
                  }
                }
              }
            },
            "responses": {
              "200": {
                "description": "配置成功",
                "content": {
                  "application/json": {
                    "schema": {
                      "$ref": "#/components/schemas/Application"
                    }
                  }
                }
              },
              "400": {
                "description": "请求参数错误",
                "content": {
                  "application/json": {
                    "schema": {
                      "$ref": "#/components/schemas/ErrorResponse"
                    }
                  }
                }
              },
              "404": {
                "description": "资源不存在",
                "content": {
                  "application/json": {
                    "schema": {
                      "$ref": "#/components/schemas/ErrorResponse"
                    }
                  }
                }
              },
              "500": {
                "description": "服务器内部错误",
                "content": {
                  "application/json": {
                    "schema": {
                      "$ref": "#/components/schemas/ErrorResponse"
                    }
                  }
                }
              }
            }
          }
        },
        "/applications/basic-info": {
          "get": {
            "operationId": "getApplicationBasicInfo",
            "summary": "查看应用基础信息",
            "description": "查看应用的基本信息，包括：\n- 名称\n- 描述\n- 版本\n- 是否配置视图",
            "tags": ["Application"],
            "parameters": [
              {
                "name": "app_id",
                "in": "query",
                "description": "应用 ID（key）",
                "required": true,
                "schema": {
                  "type": "string",
                  "maxLength": 32
                }
              }
            ],
            "responses": {
              "200": {
                "description": "获取基础信息成功",
                "content": {
                  "application/json": {
                    "schema": {
                      "$ref": "#/components/schemas/ApplicationBasicInfo"
                    }
                  }
                }
              },
              "400": {
                "description": "请求参数错误",
                "content": {
                  "application/json": {
                    "schema": {
                      "$ref": "#/components/schemas/ErrorResponse"
                    }
                  }
                }
              },
              "404": {
                "description": "资源不存在",
                "content": {
                  "application/json": {
                    "schema": {
                      "$ref": "#/components/schemas/ErrorResponse"
                    }
                  }
                }
              },
              "500": {
                "description": "服务器内部错误",
                "content": {
                  "application/json": {
                    "schema": {
                      "$ref": "#/components/schemas/ErrorResponse"
                    }
                  }
                }
              }
            }
          }
        },
        "/applications/ontologies": {
          "get": {
            "operationId": "getApplicationOntologies",
            "summary": "查看业务知识网络配置",
            "description": "查看应用的业务知识网络配置情况。\n\n**流程：**\n1. 查询应用的业务知识网络 IDs\n2. 遍历查询业务知识网络详情获取名称、描述",
            "tags": ["Application"],
            "parameters": [
              {
                "name": "app_id",
                "in": "query",
                "description": "应用 ID（key）",
                "required": true,
                "schema": {
                  "type": "string",
                  "maxLength": 32
                }
              }
            ],
            "responses": {
              "200": {
                "description": "获取业务知识网络配置成功",
                "content": {
                  "application/json": {
                    "schema": {
                      "$ref": "#/components/schemas/OntologyList"
                    }
                  }
                }
              },
              "400": {
                "description": "请求参数错误",
                "content": {
                  "application/json": {
                    "schema": {
                      "$ref": "#/components/schemas/ErrorResponse"
                    }
                  }
                }
              },
              "404": {
                "description": "资源不存在",
                "content": {
                  "application/json": {
                    "schema": {
                      "$ref": "#/components/schemas/ErrorResponse"
                    }
                  }
                }
              },
              "500": {
                "description": "服务器内部错误",
                "content": {
                  "application/json": {
                    "schema": {
                      "$ref": "#/components/schemas/ErrorResponse"
                    }
                  }
                }
              }
            }
          }
        },
        "/applications/agents": {
          "get": {
            "operationId": "getApplicationAgents",
            "summary": "查看智能体配置",
            "description": "查看应用的 Data Agent 智能体配置情况。\n\n**流程：**\n1. 查询应用的 Data Agent 智能体 IDs\n2. 查询 Data Agent 智能体详情",
            "tags": ["Application"],
            "parameters": [
              {
                "name": "app_id",
                "in": "query",
                "description": "应用 ID（key）",
                "required": true,
                "schema": {
                  "type": "string",
                  "maxLength": 32
                }
              }
            ],
            "responses": {
              "200": {
                "description": "获取智能体配置成功",
                "content": {
                  "application/json": {
                    "schema": {
                      "$ref": "#/components/schemas/AgentList"
                    }
                  }
                }
              },
              "400": {
                "description": "请求参数错误",
                "content": {
                  "application/json": {
                    "schema": {
                      "$ref": "#/components/schemas/ErrorResponse"
                    }
                  }
                }
              },
              "404": {
                "description": "资源不存在",
                "content": {
                  "application/json": {
                    "schema": {
                      "$ref": "#/components/schemas/ErrorResponse"
                    }
                  }
                }
              },
              "500": {
                "description": "服务器内部错误",
                "content": {
                  "application/json": {
                    "schema": {
                      "$ref": "#/components/schemas/ErrorResponse"
                    }
                  }
                }
              }
            }
          }
        },
        "/applications/{key}": {
          "delete": {
            "operationId": "uninstallApplication",
            "summary": "卸载应用",
            "description": "卸载指定的应用。\n\n**流程：**\n1. 调用卸载应用接口\n2. 删除数据库中应用记录",
            "tags": ["Application"],
            "parameters": [
              {
                "in": "path",
                "name": "key",
                "description": "应用唯一标识",
                "required": true,
                "schema": {
                  "type": "string",
                  "maxLength": 32
                }
              }
            ],
            "responses": {
              "204": {
                "description": "卸载应用成功"
              },
              "400": {
                "description": "请求参数错误",
                "content": {
                  "application/json": {
                    "schema": {
                      "$ref": "#/components/schemas/ErrorResponse"
                    }
                  }
                }
              },
              "404": {
                "description": "资源不存在",
                "content": {
                  "application/json": {
                    "schema": {
                      "$ref": "#/components/schemas/ErrorResponse"
                    }
                  }
                }
              },
              "500": {
                "description": "服务器内部错误",
                "content": {
                  "application/json": {
                    "schema": {
                      "$ref": "#/components/schemas/ErrorResponse"
                    }
                  }
                }
              }
            }
          }
        }
      },
      "components": {
        "securitySchemes": {
          "BearerAuth": {
            "type": "http",
            "scheme": "bearer",
            "description": "JWT Bearer Token 认证"
          }
        },
        "schemas": {
          "Application": {
            "summary": "应用信息",
            "description": "对应数据库表 t_application",
            "type": "object",
            "properties": {
              "key": {
                "type": "string",
                "title": "应用唯一标识",
                "description": "应用包的唯一标识符",
                "maxLength": 32
              },
              "name": {
                "type": "string",
                "title": "应用名称",
                "maxLength": 128
              },
              "description": {
                "type": "string",
                "title": "应用描述",
                "maxLength": 800
              },
              "icon": {
                "type": "string",
                "title": "应用图标",
                "description": "Base64 编码的图标数据"
              },
              "category": {
                "type": "string",
                "title": "应用所属分组",
                "maxLength": 128
              },
              "version": {
                "type": "string",
                "title": "应用版本号",
                "description": "必须符合语义版本号规范",
                "maxLength": 128
              },
              "release_config": {
                "type": "array",
                "title": "应用安装配置",
                "description": "记录应用安装了哪些 helm release",
                "items": {
                  "type": "string"
                },
                "example": ["release1", "release2"]
              },
              "ontology_ids": {
                "type": "array",
                "title": "业务知识网络配置",
                "description": "多个业务知识网络 ID",
                "items": {
                  "type": "integer"
                },
                "example": [1, 2]
              },
              "agent_ids": {
                "type": "array",
                "title": "智能体配置",
                "description": "多个智能体 ID",
                "items": {
                  "type": "integer"
                },
                "example": [1, 2]
              },
              "is_config": {
                "type": "boolean",
                "title": "是否完成配置",
                "description": "是否完成业务知识网络以及智能体配置",
                "default": false
              },
              "updated_by": {
                "type": "string",
                "title": "更新者用户 ID",
                "maxLength": 36
              },
              "updated_at": {
                "type": "string",
                "format": "date-time",
                "title": "更新时间"
              }
            },
            "required": ["key", "name", "release_config", "is_config", "updated_by", "updated_at"],
            "example": {
              "key": "A9F3D12C7B8E90F4A6C1E2B7D8F0A3C5",
              "name": "智能故障分析",
              "description": "DIP for ITOps 运维大脑应用",
              "version": "1.0.0",
              "icon": "iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNk+M9QDwADhgGAWjR9awAAAABJRU5ErkJggg==",
              "category": "DIP for ITOps",
              "release_config": ["app-release-1"],
              "ontology_ids": [1, 2],
              "agent_ids": [1],
              "is_config": true,
              "updated_by": "user-uuid-1234",
              "updated_at": "2025-12-13T12:00:00Z"
            }
          },
          "ApplicationList": {
            "summary": "应用列表",
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/Application"
            }
          },
          "ApplicationBasicInfo": {
            "summary": "应用基础信息",
            "description": "应用的基本信息，包括名称、描述、版本、是否配置视图",
            "type": "object",
            "properties": {
              "key": {
                "type": "string",
                "title": "应用唯一标识"
              },
              "name": {
                "type": "string",
                "title": "应用名称"
              },
              "description": {
                "type": "string",
                "title": "应用描述"
              },
              "version": {
                "type": "string",
                "title": "应用版本号"
              },
              "icon": {
                "type": "string",
                "title": "应用图标"
              },
              "category": {
                "type": "string",
                "title": "应用所属分组"
              },
              "is_config": {
                "type": "boolean",
                "title": "是否完成配置"
              },
              "updated_by": {
                "type": "string",
                "title": "更新者用户 ID"
              },
              "updated_at": {
                "type": "string",
                "format": "date-time",
                "title": "更新时间"
              }
            },
            "required": ["key", "name", "is_config", "updated_by", "updated_at"]
          },
          "OntologyInfo": {
            "summary": "业务知识网络信息",
            "type": "object",
            "properties": {
              "id": {
                "type": "integer",
                "title": "业务知识网络 ID"
              },
              "name": {
                "type": "string",
                "title": "业务知识网络名称"
              },
              "description": {
                "type": "string",
                "title": "业务知识网络描述"
              }
            },
            "required": ["id"]
          },
          "OntologyList": {
            "summary": "业务知识网络列表",
            "type": "object",
            "properties": {
              "ontologies": {
                "type": "array",
                "items": {
                  "$ref": "#/components/schemas/OntologyInfo"
                }
              }
            }
          },
          "AgentInfo": {
            "summary": "智能体信息",
            "type": "object",
            "properties": {
              "id": {
                "type": "integer",
                "title": "Data Agent 智能体 ID"
              },
              "name": {
                "type": "string",
                "title": "智能体名称"
              },
              "description": {
                "type": "string",
                "title": "智能体描述"
              }
            },
            "required": ["id"]
          },
          "AgentList": {
            "summary": "智能体列表",
            "type": "object",
            "properties": {
              "agents": {
                "type": "array",
                "items": {
                  "$ref": "#/components/schemas/AgentInfo"
                }
              }
            }
          },
          "ApplicationConfigRequest": {
            "summary": "应用配置请求体",
            "description": "用于配置应用的业务知识网络和智能体",
            "type": "object",
            "properties": {
              "ontology_ids": {
                "type": "array",
                "title": "业务知识网络 ID 列表",
                "items": {
                  "type": "integer"
                }
              },
              "agent_ids": {
                "type": "array",
                "title": "智能体 ID 列表",
                "items": {
                  "type": "integer"
                }
              }
            }
          },
          "ErrorResponse": {
            "description": "接口错误信息",
            "type": "object",
            "properties": {
              "code": {
                "description": "业务错误码",
                "type": "string"
              },
              "description": {
                "description": "错误描述",
                "type": "string"
              },
              "solution": {
                "description": "错误处理建议",
                "type": "string"
              },
              "detail": {
                "description": "错误详细信息",
                "type": "object"
              },
              "link": {
                "description": "错误帮助地址",
                "type": "string"
              }
            },
            "required": ["code", "description"]
          }
        }
      }
    };

    window.onload = function() {
      SwaggerUIBundle({
        spec: spec,
        dom_id: '#swagger-ui',
        deepLinking: true,
        presets: [
          SwaggerUIBundle.presets.apis,
          SwaggerUIStandalonePreset
        ],
        plugins: [
          SwaggerUIBundle.plugins.DownloadUrl
        ],
        layout: "StandaloneLayout"
      });
    };
  </script>
</body>
</html>
